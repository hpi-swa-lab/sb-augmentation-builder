/* esm.sh - esbuild bundle(@codemirror/search@6.5.4) es2022 production */
import{showPanel as oe,EditorView as M,getPanel as E,Decoration as d,ViewPlugin as ce,runScopeHandlers as Se}from"./view.mjs";import{codePointAt as ye,fromCodePoint as ve,codePointSize as be,StateEffect as W,StateField as ae,EditorSelection as p,Facet as he,combineConfig as ue,CharCategory as m,RangeSetBuilder as Ce,Prec as ke,EditorState as Le,findClusterBreak as fe}from"./state.mjs";import h from"./crelt.mjs";var re=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t,S=class{constructor(e,n,r=0,i=e.length,s,l){this.test=l,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,i),this.bufferStart=r,this.normalize=s?o=>s(re(o)):re,this.query=this.normalize(n)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return ye(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let n=ve(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=be(e);let i=this.normalize(n);for(let s=0,l=r;;s++){let o=i.charCodeAt(s),c=this.match(o,l);if(s==i.length-1){if(c)return this.value=c,this;break}l==r&&s<n.length&&n.charCodeAt(s)==o&&l++}}}match(e,n){let r=null;for(let i=0;i<this.matches.length;i+=2){let s=this.matches[i],l=!1;this.query.charCodeAt(s)==e&&(s==this.query.length-1?r={from:this.matches[i+1],to:n+1}:(this.matches[i]++,l=!0)),l||(this.matches.splice(i,2),i-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?r={from:n,to:n+1}:this.matches.push(1,n)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferStart)&&(r=null),r}};typeof Symbol<"u"&&(S.prototype[Symbol.iterator]=function(){return this});var de={from:-1,to:-1,match:/.*/.exec("")},X="gm"+(/x/.unicode==null?"":"u"),P=class{constructor(e,n,r,i=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=de,/\\[sWDnr]|\n|\r|\[\^/.test(n))return new I(e,n,r,i,s);this.re=new RegExp(n,X+(r?.ignoreCase?"i":"")),this.test=r?.test,this.iter=e.iter();let l=e.lineAt(i);this.curLineStart=l.from,this.matchPos=w(e,i),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let n=this.matchPos<=this.to&&this.re.exec(this.curLine);if(n){let r=this.curLineStart+n.index,i=r+n[0].length;if(this.matchPos=w(this.text,i+(r==i?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<i||r>this.value.to)&&(!this.test||this.test(r,i,n)))return this.value={from:r,to:i,match:n},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}},K=new WeakMap,R=class t{constructor(e,n){this.from=e,this.text=n}get to(){return this.from+this.text.length}static get(e,n,r){let i=K.get(e);if(!i||i.from>=r||i.to<=n){let o=new t(n,e.sliceString(n,r));return K.set(e,o),o}if(i.from==n&&i.to==r)return i;let{text:s,from:l}=i;return l>n&&(s=e.sliceString(n,l)+s,l=n),i.to<r&&(s+=e.sliceString(i.to,r)),K.set(e,new t(l,s)),new t(n,s.slice(n-l,r-l))}},I=class{constructor(e,n,r,i,s){this.text=e,this.to=s,this.done=!1,this.value=de,this.matchPos=w(e,i),this.re=new RegExp(n,X+(r?.ignoreCase?"i":"")),this.test=r?.test,this.flat=R.get(e,i,this.chunkEnd(i+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,n=this.re.exec(this.flat.text);if(n&&!n[0]&&n.index==e&&(this.re.lastIndex=e+1,n=this.re.exec(this.flat.text)),n){let r=this.flat.from+n.index,i=r+n[0].length;if((this.flat.to>=this.to||n.index+n[0].length<=this.flat.text.length-10)&&(!this.test||this.test(r,i,n)))return this.value={from:r,to:i,match:n},this.matchPos=w(this.text,i+(r==i?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=R.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};typeof Symbol<"u"&&(P.prototype[Symbol.iterator]=I.prototype[Symbol.iterator]=function(){return this});function We(t){try{return new RegExp(t,X),!0}catch{return!1}}function w(t,e){if(e>=t.length)return e;let n=t.lineAt(e),r;for(;e<n.to&&(r=n.text.charCodeAt(e-n.from))>=56320&&r<57344;)e++;return e}function G(t){let e=String(t.state.doc.lineAt(t.state.selection.main.head).number),n=h("input",{class:"cm-textfield",name:"line",value:e}),r=h("form",{class:"cm-gotoLine",onkeydown:s=>{s.keyCode==27?(s.preventDefault(),t.dispatch({effects:T.of(!1)}),t.focus()):s.keyCode==13&&(s.preventDefault(),i())},onsubmit:s=>{s.preventDefault(),i()}},h("label",t.state.phrase("Go to line"),": ",n)," ",h("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function i(){let s=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(n.value);if(!s)return;let{state:l}=t,o=l.doc.lineAt(l.selection.main.head),[,c,a,u,x]=s,A=u?+u.slice(1):0,C=a?+a:o.number;if(a&&x){let H=C/100;c&&(H=H*(c=="-"?-1:1)+o.number/l.doc.lines),C=Math.round(l.doc.lines*H)}else a&&c&&(C=C*(c=="-"?-1:1)+o.number);let te=l.doc.line(Math.max(1,Math.min(l.doc.lines,C))),ne=p.cursor(te.from+Math.max(0,Math.min(A,te.length)));t.dispatch({effects:[T.of(!1),M.scrollIntoView(ne.from,{y:"center"})],selection:ne}),t.focus()}return{dom:r}}var T=W.define(),ie=ae.define({create(){return!0},update(t,e){for(let n of e.effects)n.is(T)&&(t=n.value);return t},provide:t=>oe.from(t,e=>e?G:null)}),Fe=t=>{let e=E(t,G);if(!e){let n=[T.of(!0)];t.state.field(ie,!1)==null&&n.push(W.appendConfig.of([ie,Ae])),t.dispatch({effects:n}),e=E(t,G)}return e&&e.dom.querySelector("input").select(),!0},Ae=M.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),De={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},me=he.define({combine(t){return ue(t,De,{highlightWordAroundCursor:(e,n)=>e||n,minSelectionLength:Math.min,maxMatches:Math.min})}});function Ue(t){let e=[Ie,Re];return t&&e.push(me.of(t)),e}var qe=d.mark({class:"cm-selectionMatch"}),Ee=d.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function se(t,e,n,r){return(n==0||t(e.sliceDoc(n-1,n))!=m.Word)&&(r==e.doc.length||t(e.sliceDoc(r,r+1))!=m.Word)}function Pe(t,e,n,r){return t(e.sliceDoc(n,n+1))==m.Word&&t(e.sliceDoc(r-1,r))==m.Word}var Re=ce.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(me),{state:n}=t,r=n.selection;if(r.ranges.length>1)return d.none;let i=r.main,s,l=null;if(i.empty){if(!e.highlightWordAroundCursor)return d.none;let c=n.wordAt(i.head);if(!c)return d.none;l=n.charCategorizer(i.head),s=n.sliceDoc(c.from,c.to)}else{let c=i.to-i.from;if(c<e.minSelectionLength||c>200)return d.none;if(e.wholeWords){if(s=n.sliceDoc(i.from,i.to),l=n.charCategorizer(i.head),!(se(l,n,i.from,i.to)&&Pe(l,n,i.from,i.to)))return d.none}else if(s=n.sliceDoc(i.from,i.to).trim(),!s)return d.none}let o=[];for(let c of t.visibleRanges){let a=new S(n.doc,s,c.from,c.to);for(;!a.next().done;){let{from:u,to:x}=a.value;if((!l||se(l,n,u,x))&&(i.empty&&u<=i.from&&x>=i.to?o.push(Ee.range(u,x)):(u>=i.to||x<=i.from)&&o.push(qe.range(u,x)),o.length>e.maxMatches))return d.none}}return d.set(o)}},{decorations:t=>t.decorations}),Ie=M.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),we=({state:t,dispatch:e})=>{let{selection:n}=t,r=p.create(n.ranges.map(i=>t.wordAt(i.head)||p.cursor(i.head)),n.mainIndex);return r.eq(n)?!1:(e(t.update({selection:r})),!0)};function Te(t,e){let{main:n,ranges:r}=t.selection,i=t.wordAt(n.head),s=i&&i.from==n.from&&i.to==n.to;for(let l=!1,o=new S(t.doc,e,r[r.length-1].to);;)if(o.next(),o.done){if(l)return null;o=new S(t.doc,e,0,Math.max(0,r[r.length-1].from-1)),l=!0}else{if(l&&r.some(c=>c.from==o.value.from))continue;if(s){let c=t.wordAt(o.value.from);if(!c||c.from!=o.value.from||c.to!=o.value.to)continue}return o.value}}var Oe=({state:t,dispatch:e})=>{let{ranges:n}=t.selection;if(n.some(s=>s.from===s.to))return we({state:t,dispatch:e});let r=t.sliceDoc(n[0].from,n[0].to);if(t.selection.ranges.some(s=>t.sliceDoc(s.from,s.to)!=r))return!1;let i=Te(t,r);return i?(e(t.update({selection:t.selection.addRange(p.range(i.from,i.to),!1),effects:M.scrollIntoView(i.to)})),!0):!1},y=he.define({combine(t){return ue(t,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new J(e),scrollToMatch:e=>M.scrollIntoView(e)})}});function Xe(t){return t?[y.of(t),U]:U}var O=class{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||We(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(n,r)=>r=="n"?`
`:r=="r"?"\r":r=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new j(this):new Q(this)}getCursor(e,n=0,r){let i=e.doc?e:Le.create({doc:e});return r==null&&(r=i.doc.length),this.regexp?b(this,i,n,r):v(this,i,n,r)}},$=class{constructor(e){this.spec=e}};function v(t,e,n,r){return new S(e.doc,t.unquoted,n,r,t.caseSensitive?void 0:i=>i.toLowerCase(),t.wholeWord?$e(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function $e(t,e){return(n,r,i,s)=>((s>n||s+i.length<r)&&(s=Math.max(0,n-2),i=t.sliceString(s,Math.min(t.length,r+2))),(e(_(i,n-s))!=m.Word||e(z(i,n-s))!=m.Word)&&(e(z(i,r-s))!=m.Word||e(_(i,r-s))!=m.Word))}var Q=class extends ${constructor(e){super(e)}nextMatch(e,n,r){let i=v(this.spec,e,r,e.doc.length).nextOverlapping();return i.done&&(i=v(this.spec,e,0,n).nextOverlapping()),i.done?null:i.value}prevMatchInRange(e,n,r){for(let i=r;;){let s=Math.max(n,i-1e4-this.spec.unquoted.length),l=v(this.spec,e,s,i),o=null;for(;!l.nextOverlapping().done;)o=l.value;if(o)return o;if(s==n)return null;i-=1e4}}prevMatch(e,n,r){return this.prevMatchInRange(e,0,n)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,n){let r=v(this.spec,e,0,e.doc.length),i=[];for(;!r.next().done;){if(i.length>=n)return null;i.push(r.value)}return i}highlight(e,n,r,i){let s=v(this.spec,e,Math.max(0,n-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)i(s.value.from,s.value.to)}};function b(t,e,n,r){return new P(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?_e(e.charCategorizer(e.selection.main.head)):void 0},n,r)}function _(t,e){return t.slice(fe(t,e,!1),e)}function z(t,e){return t.slice(e,fe(t,e))}function _e(t){return(e,n,r)=>!r[0].length||(t(_(r.input,r.index))!=m.Word||t(z(r.input,r.index))!=m.Word)&&(t(z(r.input,r.index+r[0].length))!=m.Word||t(_(r.input,r.index+r[0].length))!=m.Word)}var j=class extends ${nextMatch(e,n,r){let i=b(this.spec,e,r,e.doc.length).next();return i.done&&(i=b(this.spec,e,0,n).next()),i.done?null:i.value}prevMatchInRange(e,n,r){for(let i=1;;i++){let s=Math.max(n,r-i*1e4),l=b(this.spec,e,s,r),o=null;for(;!l.next().done;)o=l.value;if(o&&(s==n||o.from>s+10))return o;if(s==n)return null}}prevMatch(e,n,r){return this.prevMatchInRange(e,0,n)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(n,r)=>r=="$"?"$":r=="&"?e.match[0]:r!="0"&&+r<e.match.length?e.match[r]:n))}matchAll(e,n){let r=b(this.spec,e,0,e.doc.length),i=[];for(;!r.next().done;){if(i.length>=n)return null;i.push(r.value)}return i}highlight(e,n,r,i){let s=b(this.spec,e,Math.max(0,n-250),Math.min(r+250,e.doc.length));for(;!s.next().done;)i(s.value.from,s.value.to)}},L=W.define(),Y=W.define(),g=ae.define({create(t){return new k(V(t).create(),null)},update(t,e){for(let n of e.effects)n.is(L)?t=new k(n.value.create(),t.panel):n.is(Y)&&(t=new k(t.query,n.value?Z:null));return t},provide:t=>oe.from(t,e=>e.panel)});function Ye(t){let e=t.field(g,!1);return e?e.query.spec:V(t)}function Ze(t){var e;return((e=t.field(g,!1))===null||e===void 0?void 0:e.panel)!=null}var k=class{constructor(e,n){this.query=e,this.panel=n}},ze=d.mark({class:"cm-searchMatch"}),Be=d.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Ne=ce.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(g))}update(t){let e=t.state.field(g);(e!=t.startState.field(g)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return d.none;let{view:n}=this,r=new Ce;for(let i=0,s=n.visibleRanges,l=s.length;i<l;i++){let{from:o,to:c}=s[i];for(;i<l-1&&c>s[i+1].from-2*250;)c=s[++i].to;t.highlight(n.state,o,c,(a,u)=>{let x=n.state.selection.ranges.some(A=>A.from==a&&A.to==u);r.add(a,u,x?Be:ze)})}return r.finish()}},{decorations:t=>t.decorations});function F(t){return e=>{let n=e.state.field(g,!1);return n&&n.query.spec.valid?t(e,n):xe(e)}}var B=F((t,{query:e})=>{let{to:n}=t.state.selection.main,r=e.nextMatch(t.state,n,n);if(!r)return!1;let i=p.single(r.from,r.to),s=t.state.facet(y);return t.dispatch({selection:i,effects:[ee(t,r),s.scrollToMatch(i.main,t)],userEvent:"select.search"}),ge(t),!0}),N=F((t,{query:e})=>{let{state:n}=t,{from:r}=n.selection.main,i=e.prevMatch(n,r,r);if(!i)return!1;let s=p.single(i.from,i.to),l=t.state.facet(y);return t.dispatch({selection:s,effects:[ee(t,i),l.scrollToMatch(s.main,t)],userEvent:"select.search"}),ge(t),!0}),Ve=F((t,{query:e})=>{let n=e.matchAll(t.state,1e3);return!n||!n.length?!1:(t.dispatch({selection:p.create(n.map(r=>p.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),He=({state:t,dispatch:e})=>{let n=t.selection;if(n.ranges.length>1||n.main.empty)return!1;let{from:r,to:i}=n.main,s=[],l=0;for(let o=new S(t.doc,t.sliceDoc(r,i));!o.next().done;){if(s.length>1e3)return!1;o.value.from==r&&(l=s.length),s.push(p.range(o.value.from,o.value.to))}return e(t.update({selection:p.create(s,l),userEvent:"select.search.matches"})),!0},le=F((t,{query:e})=>{let{state:n}=t,{from:r,to:i}=n.selection.main;if(n.readOnly)return!1;let s=e.nextMatch(n,r,r);if(!s)return!1;let l=[],o,c,a=[];if(s.from==r&&s.to==i&&(c=n.toText(e.getReplacement(s)),l.push({from:s.from,to:s.to,insert:c}),s=e.nextMatch(n,s.from,s.to),a.push(M.announce.of(n.phrase("replaced match on line $",n.doc.lineAt(r).number)+"."))),s){let u=l.length==0||l[0].from>=s.to?0:s.to-s.from-c.length;o=p.single(s.from-u,s.to-u),a.push(ee(t,s)),a.push(n.facet(y).scrollToMatch(o.main,t))}return t.dispatch({changes:l,selection:o,effects:a,userEvent:"input.replace"}),!0}),Ke=F((t,{query:e})=>{if(t.state.readOnly)return!1;let n=e.matchAll(t.state,1e9).map(i=>{let{from:s,to:l}=i;return{from:s,to:l,insert:e.getReplacement(i)}});if(!n.length)return!1;let r=t.state.phrase("replaced $ matches",n.length)+".";return t.dispatch({changes:n,effects:M.announce.of(r),userEvent:"input.replace.all"}),!0});function Z(t){return t.state.facet(y).createPanel(t)}function V(t,e){var n,r,i,s,l;let o=t.selection.main,c=o.empty||o.to>o.from+100?"":t.sliceDoc(o.from,o.to);if(e&&!c)return e;let a=t.facet(y);return new O({search:((n=e?.literal)!==null&&n!==void 0?n:a.literal)?c:c.replace(/\n/g,"\\n"),caseSensitive:(r=e?.caseSensitive)!==null&&r!==void 0?r:a.caseSensitive,literal:(i=e?.literal)!==null&&i!==void 0?i:a.literal,regexp:(s=e?.regexp)!==null&&s!==void 0?s:a.regexp,wholeWord:(l=e?.wholeWord)!==null&&l!==void 0?l:a.wholeWord})}function pe(t){let e=E(t,Z);return e&&e.dom.querySelector("[main-field]")}function ge(t){let e=pe(t);e&&e==t.root.activeElement&&e.select()}var xe=t=>{let e=t.state.field(g,!1);if(e&&e.panel){let n=pe(t);if(n&&n!=t.root.activeElement){let r=V(t.state,e.query.spec);r.valid&&t.dispatch({effects:L.of(r)}),n.focus(),n.select()}}else t.dispatch({effects:[Y.of(!0),e?L.of(V(t.state,e.query.spec)):W.appendConfig.of(U)]});return!0},Me=t=>{let e=t.state.field(g,!1);if(!e||!e.panel)return!1;let n=E(t,Z);return n&&n.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:Y.of(!1)}),!0},et=[{key:"Mod-f",run:xe,scope:"editor search-panel"},{key:"F3",run:B,shift:N,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:B,shift:N,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Me,scope:"editor search-panel"},{key:"Mod-Shift-l",run:He},{key:"Alt-g",run:Fe},{key:"Mod-d",run:Oe,preventDefault:!0}],J=class{constructor(e){this.view=e;let n=this.query=e.state.field(g).query.spec;this.commit=this.commit.bind(this),this.searchField=h("input",{value:n.search,placeholder:f(e,"Find"),"aria-label":f(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=h("input",{value:n.replace,placeholder:f(e,"Replace"),"aria-label":f(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=h("input",{type:"checkbox",name:"case",form:"",checked:n.caseSensitive,onchange:this.commit}),this.reField=h("input",{type:"checkbox",name:"re",form:"",checked:n.regexp,onchange:this.commit}),this.wordField=h("input",{type:"checkbox",name:"word",form:"",checked:n.wholeWord,onchange:this.commit});function r(i,s,l){return h("button",{class:"cm-button",name:i,onclick:s,type:"button"},l)}this.dom=h("div",{onkeydown:i=>this.keydown(i),class:"cm-search"},[this.searchField,r("next",()=>B(e),[f(e,"next")]),r("prev",()=>N(e),[f(e,"previous")]),r("select",()=>Ve(e),[f(e,"all")]),h("label",null,[this.caseField,f(e,"match case")]),h("label",null,[this.reField,f(e,"regexp")]),h("label",null,[this.wordField,f(e,"by word")]),...e.state.readOnly?[]:[h("br"),this.replaceField,r("replace",()=>le(e),[f(e,"replace")]),r("replaceAll",()=>Ke(e),[f(e,"replace all")])],h("button",{name:"close",onclick:()=>Me(e),"aria-label":f(e,"close"),type:"button"},["\xD7"])])}commit(){let e=new O({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:L.of(e)}))}keydown(e){Se(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?N:B)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),le(this.view))}update(e){for(let n of e.transactions)for(let r of n.effects)r.is(L)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(y).top}};function f(t,e){return t.state.phrase(e)}var D=30,q=/[\s\.,:;?!]/;function ee(t,{from:e,to:n}){let r=t.state.doc.lineAt(e),i=t.state.doc.lineAt(n).to,s=Math.max(r.from,e-D),l=Math.min(i,n+D),o=t.state.sliceDoc(s,l);if(s!=r.from){for(let c=0;c<D;c++)if(!q.test(o[c+1])&&q.test(o[c])){o=o.slice(c);break}}if(l!=i){for(let c=o.length-1;c>o.length-D;c--)if(!q.test(o[c-1])&&q.test(o[c])){o=o.slice(0,c);break}}return M.announce.of(`${t.state.phrase("current match")}. ${o} ${t.state.phrase("on line")} ${r.number}.`)}var Ge=M.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),U=[g,ke.low(Ne),Ge];export{P as RegExpCursor,S as SearchCursor,O as SearchQuery,Me as closeSearchPanel,B as findNext,N as findPrevious,Ye as getSearchQuery,Fe as gotoLine,Ue as highlightSelectionMatches,xe as openSearchPanel,Ke as replaceAll,le as replaceNext,Xe as search,et as searchKeymap,Ze as searchPanelOpen,Ve as selectMatches,Oe as selectNextOccurrence,He as selectSelectionMatches,L as setSearchQuery};
